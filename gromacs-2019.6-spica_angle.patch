--- ../gromacs-2019.6/src/gromacs/listed-forces/bonded.cpp	2022-07-28 18:19:46.583734006 +0900
+++ src/gromacs/listed-forces/bonded.cpp	2022-07-28 18:20:20.716965205 +0900
@@ -1122,6 +1122,12 @@
     real dVdt, va, vtot, dr, dr2, vbond, fbond, fik;
     real kthA, th0A, kUBA, r13A, kthB, th0B, kUBB, r13B;
     ivec jt, dt_ij, dt_kj, dt_ik;
+    //for LJ 9-6 /////////////////////
+    real Acoeff, v96, rmin, rmin2, fmag;
+    real sigA, epsA, sigB, epsB;
+    real AA1, AA2, AA4, AA6, AA7, AA9, AA10, tmp, hoge;
+    Acoeff = 27.0/4.0;
+    //////////////////////////////////
 
     vtot = 0.0;
     for (i = 0; (i < nbonds); )
@@ -1138,6 +1144,14 @@
         kthB  = forceparams[type].u_b.kthetaB;
         r13B  = forceparams[type].u_b.r13B;
         kUBB  = forceparams[type].u_b.kUBB;
+	// for LJ9-6 ///////////////////////
+	sigA  = r13A;
+	epsA  = kUBA;
+	sigB  = r13B;
+	epsB  = kUBB;
+	rmin  = 1.144714243*sigA;
+	rmin2 = gmx::square(rmin);
+	////////////////////////////////////
 
         theta  = bond_angle(x[ai], x[aj], x[ak], pbc,
                             r_ij, r_kj, &cos_theta, &t1, &t2);                     /*  41		*/
@@ -1148,9 +1162,22 @@
         ki   = pbc_rvec_sub(pbc, x[ai], x[ak], r_ik);                               /*   3      */
         dr2  = iprod(r_ik, r_ik);                                                   /*   5		*/
         dr   = dr2*gmx::invsqrt(dr2);                                               /*  10		*/
-
-        *dvdlambda += harmonic(kUBA, kUBB, r13A, r13B, dr, lambda, &vbond, &fbond); /*  19  */
-
+	// for LJ9-6 ///////////////////////
+	AA1  = sigA/dr;
+	AA2  = gmx::square(AA1);
+	AA4  = gmx::square(AA2);
+	AA6  = AA2*AA4; 
+	AA7  = AA1*AA6; 
+	AA9  = AA2*AA7;
+	AA10 = AA1*AA9;
+	AA7 *= 6.0;
+	AA10*= 9.0;
+	v96  = Acoeff*epsA*(AA9 - AA6);
+	////////////////////////////////////
+
+        // comment out 
+        //*dvdlambda += harmonic(kUBA, kUBB, r13A, r13B, dr, lambda, &vbond, &fbond); /*  19  */
+	//
         cos_theta2 = gmx::square(cos_theta);                                        /*   1		*/
         if (cos_theta2 < 1)
         {
@@ -1191,22 +1218,29 @@
             rvec_inc(fshift[t2], f_k);
         }                                       /* 161 TOTAL	*/
         /* Time for the bond calculations */
-        if (dr2 == 0.0)
+	// for LJ9-6 
+        if (dr2 > rmin2)
         {
             continue;
         }
 
-        vtot  += vbond;             /* 1*/
-        fbond *= gmx::invsqrt(dr2); /*   6		*/
+        //vtot  += vbond;             /* 1*/
+        //fbond *= gmx::invsqrt(dr2); /*   6		*/
+	vbond = v96 + epsA;
+	hoge  = epsA/sigA;
+	fmag  = Acoeff*hoge*(AA10 - AA7)*gmx::invsqrt(dr2);
+        vtot += vbond;              /* 1*/
 
         if (g)
         {
             ivec_sub(SHIFT_IVEC(g, ai), SHIFT_IVEC(g, ak), dt_ik);
             ki = IVEC2IS(dt_ik);
-        }
+            fik                 = fmag*r_ik[m];
+	}
         for (m = 0; (m < DIM); m++)     /*  15		*/
         {
-            fik                 = fbond*r_ik[m];
+            //fik                 = fbond*r_ik[m];
+            fik                 = fmag*r_ik[m];
             f[ai][m]           += fik;
             f[ak][m]           -= fik;
             fshift[ki][m]      += fik;
